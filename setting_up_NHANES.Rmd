---
title: "Setting up Nhanes Data"
author: "Niamh Harford 20251644"
date: "4/2/2021"
output: html_document
---

```{r}
#Packages I need
suppressMessages(library(nhanesA))
suppressMessages(library(tidyverse))
suppressMessages(library(ggplot2))
```

```{r}
#Here I am seraching through the data file names to file the variables I require
nhanesTableVars('DEMO', 'DEMO_I')
nhanesTableVars('Q', 'SMQ_J')
nhanesTableVars('Q', 'DIQ_J')
nhanesTableVars('Q', 'KIQ_U_J')
nhanesTableVars('Q','BPQ_I')
nhanesTableVars('DIET', 'DR1TOT_I')
```


```{r}
#2015/2016 data
smq_i <- nhanes('SMQ_I') 
demo_i <- nhanes('DEMO_I')
diq_i <- nhanes('DIQ_I') 
kiq_u_i <- nhanes('KIQ_U_I')
bmx_i <- nhanes('BMX_I')
bpq_i <- nhanes('BPQ_I')
paq_i <- nhanes('PAQ_I')
alq_i <- nhanes('ALQ_I')
dr1tot_i <- nhanes('DR1TOT_I') #salt and potassium
```

```{r}
#Translate
demo_i <- nhanesTranslate('DEMO_I', c('RIAGENDR', 'RIDRETH1', 'RIDAGEYR'), data=demo_i)
bmx_i <- nhanesTranslate('BMX_I', 'BMXBMI', data=bmx_i) #no columns translated
smq_i <- nhanesTranslate('SMQ_I', 'SMQ020', data=smq_i)
diq_i <- nhanesTranslate('DIQ_I', c('DIQ010', 'DIQ050'), data=diq_i)
kiq_u_i <- nhanesTranslate('KIQ_U_I', c('KIQ022'), data=kiq_u_i)
bpq_i <- nhanesTranslate('BPQ_I', 'BPQ020', data=bpq_i)
paq_i <- nhanesTranslate('PAQ_I', 'PAD675', data = paq_i)
alq_i <- nhanesTranslate('ALQ_I', 'ALQ101', data = alq_i)
dr1tot_i <- nhanesTranslate('DR1TOT_I', c('DBD100','DR1TPOTA'), data = dr1tot_i)
```

```{r}
#merging the data
comb1 <- merge(demo_i, smq_i)
comb2 <- merge(comb1, diq_i)
comb3 <- merge(comb2, kiq_u_i)
comb4 <- merge(comb3, bmx_i)
comb5 <- merge(comb4, bpq_i)
comb6 <- merge(comb5, paq_i)
comb7 <- merge(comb6, alq_i)
comb8 <- merge(comb7, dr1tot_i)
select_cols <- c('BPQ020','RIAGENDR', 'RIDAGEYR', 'RIDRETH1', 'SMQ020', 'DIQ010', 'DIQ050', 'KIQ022', 'BMXBMI', 'PAQ665', 'ALQ101', 'DBD100', 'DR1TPOTA')
comb_data <- comb8 %>% select(all_of(select_cols))
```

```{r}
#Another way to join data
select_cols <- c('BPQ020','RIAGENDR', 'RIDAGEYR', 'RIDRETH1', 'SMQ020', 'DIQ010', 'DIQ050', 'KIQ022', 'BMXBMI', 'PAQ665','ALQ101', 'DBD100', 'DR1TPOTA')
all_dat <- Reduce(merge, list(demo_i, smq_i, diq_i, kiq_u_i, bmx_i, bpq_i, paq_i, alq_i,dr1tot_i))
all_dat <- all_dat %>% select(all_of(select_cols))
head(all_dat)
```