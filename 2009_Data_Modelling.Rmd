---
title: "Data Modelling 2009-2010 Data Set"
author: "Niamh Harford 20251644"
date: "5/7/2021"
output: html_document
---

```{r}
# Load in all the data
load("~/Documents/Masters/Dissertation/Project_Git/Data/data2_09_10.RData") 
# Minus Don't Know and Nas 2009-2010
```

```{r}
# Load in necessary packages
suppressMessages(library(tidyverse))
suppressMessages(library(sjPlot))
suppressMessages(library(sjlabelled))
suppressMessages(library(sjmisc))
```

##### Data Minus Don't Know and NA Values 2009-2010

```{r, results='hide'}
#Logistic regression
data2$Hypertension <-ifelse(data2$Hypertension == "Yes", 1 ,0)
data2$Hypertension %>% table
log_reg1 <- glm(Hypertension ~ ., data = data2, family = binomial())
summary(log_reg1)
```

```{r}
coefficients(log_reg1) %>% exp() %>% round(digits = 5)
```

#### **Interpretation:**
+ The odds of having hypertension if you're a female is expected to increase by roughly 4%. 

+ For a one unit increase in age you would expect your odds of having hypertension to increase by roughly 7%.

+ When you move from American Mexican race to Other Hispanic, the odds of having hypertension increases by roughly 25%.

+ When you move from American Mexican race to Non-Hispanic White, the odds of having hypertension increases by roughly 13%.

+ When you move from American Mexican race to Non-Hispanic Black, the odds of having hypertension is expected to be roughly 2.07 times higher.

+ When you move from American Mexican race to Other Race including multi-race, the odds of having hypertension increases by roughly 77%.

+ When you move from smoking to not smoking, the odds of having hypertension decreases by roughly 13%.

+ When you move from having diabetes to not having diabetes, the odds of having hypertension decreases by roughly 68%.

+ When you move from having diabetes to borderline having diabetes, the odds of having hypertension decreases by roughly 33%.

+ When you move from taking insulin to not taking insulin, the odds of having hypertension increases by roughly 38%.

+ When you move from having chronic kidney disease to not having chronic kidney disease, the odds of having hypertension decreases by roughly 78%.

+ For a one unit increase in BMI you would expect your odds of having hypertension to increase by roughly 8%. 
+ When you move from being physically active to not being physically active, the odds of having hypertension increases by roughly 9%.

+ When you move from drinking at least 12 alcoholic drinks in a year to not, the odds of having hypertension increases by roughly 8%.

+ When you move from never using salt to rarely, the odds of having hypertension decreases by roughly 25%.

+ When you move from never using salt to occasionally, the odds of having hypertension decreases by roughly 12%.

+ When you move from never using rarely to very often, the odds of having hypertension decreases by roughly 27%.

+ For a one unit increase in potassium you would expect your odds of having hypertension to be equally likely.


**Variables that decreases the odds of Hypertension **


+ Not Smoking 
+ Not Having Diabetes
+ Borderline Having Diabetes
+ Not Having Chronic Kidney Disease
+ Use of Salt in Food Prep



**Plotting estimates of logistic regression models**

```{r}
#2009-2010 Reduced Data
plot_model(log_reg1, vline.color = "black", sort.est = TRUE)
plot_model(log_reg1, show.values = TRUE, value.offset = .3, sort.est = T)
```





**Residuals**


```{r}
# All data 2015-2016
plot(log_reg1)
```

```{r, echo=FALSE, eval=FALSE}
# 2009-2010 All Data
suppressMessages(library(arm))
binnedplot(fitted(log_reg1), 
           residuals(log_reg1, type = "response"), 
           nclass = NULL, 
           xlab = "Expected Values", 
           ylab = "Average residual", 
           main = "Binned residual plot", 
           cex.pts = 0.8, 
           col.pts = 1, 
           col.int = "gray")

# The grey lines represent  Â±  2 SE bands, which we would expect to contain about 95% of the observations.
# https://bookdown.org/jefftemplewebb/IS-6489/logistic-regression.html 
```

```{r}
prob <- predict(log_reg1, type="response")
pred <- factor(ifelse(prob < .5, "No", "Yes"))
table(data2$Hypertension, pred)
```




**Smoothing Spline For BMI and Age**

```{r}
head(data2)
# Hypertension vs BMI
suppressMessages(library(splines))

f1 <- smooth.spline(data2$BMI,data2$Hypertension, cv = T)
# cross-validation with non-unique 'x' values seems doubtful

ggplot(data=data2, aes(x=BMI, y=Hypertension))+ geom_point() +
geom_line(aes(y=fitted(f1)), color="green")

f2 <- glm(Hypertension ~ bs(BMI,df=5), data=data2, family = binomial)
attr(bs(data2$BMI, df=5), "knots")

ggplot(data=data2, aes(x=BMI, y=Hypertension)) + geom_point() + 
  geom_line(aes(y=fitted(f2)), color= "blue") + geom_vline(xintercept = attr(bs(data2$BMI, df=5), "knots"), colour = "magenta")
```

```{r}
suppressMessages(library(gam))
gam_logistic = gam(Hypertension ~ Gender + s(Age, df = 5) + Race + Smoking + Diabetes + 
                     Insulin + KidneyF + s(BMI,df=5) + PhysActivity + Alcohol + Salt +
                     Potassium, data=data2, family = binomial())

plot(gam_logistic, se = T, col = "green")
```


**Random Forest**

```{r}
load("~/Documents/Masters/Dissertation/Project_Git/Data/data2_09_10.RData")
suppressMessages(library(randomForest))
rf <- randomForest(Hypertension ~ .,data=data2)
rf1 <- randomForest(Hypertension ~ .,data=data2, importance = T, ntree = 1000)

rf
varImpPlot(rf)
rf1
varImpPlot(rf1)

```


```{r}
#Decision Trees

suppressMessages(library(tree))
tree <- tree(Hypertension ~ BMI + Age, data=data2)
summary(tree)
plot(tree)
text(tree, cex=.5, pretty=0)

tree1 <- tree(Hypertension ~ ., data=data2)
summary(tree1)
plot(tree1)
text(tree1, cex=.5, pretty=0)

library(rpart)
f1 <- rpart(Hypertension ~ ., data=data2)
plot(f1)
text(f1, cex=.5, pretty = 0)
```

```{r, results='hide'}
#Logistic Regression - Interaction with Gender

data2$Hypertension <-ifelse(data2$Hypertension == "Yes", 1 ,0)
data2$Hypertension %>% table
log_reg_gender <- glm(Hypertension ~ .*Gender, data = data2, family = binomial())
summary(log_reg_gender)
```

```{r}
coefficients(log_reg_gender) %>% exp() %>% round(digits = 4)
```

#### **Interpretation:**
+ The odds of having hypertension if you're a female is expected to be 5.48 times higher. 

+ For a one unit increase in age if you are male, you would expect your odds of having hypertension to increase by roughly 6%.

+ When you move from American Mexican race to Other Hispanic if you are male, the odds of having hypertension increases by roughly 30%.

+ When you move from American Mexican race to Non-Hispanic White if you are male, the odds of having hypertension increases by roughly 39%.

+ When you move from American Mexican race to Non-Hispanic Black if you are male, the odds of having hypertension is expected to be roughly 2.49 times higher.

+ When you move from American Mexican race to Other Race including multi-race, the odds of having hypertension is expected to be roughly 2.09 times higher.

+ When you move from smoking to not smoking if you are male, the odds of having hypertension decreases by roughly 1%.

+ When you move from having diabetes to not having diabetes if you are male, the odds of having hypertension decreases by roughly 59%.

+ When you move from having diabetes to borderline having diabetes if you are male, the odds of having hypertension decreases by roughly 14%.

+ When you move from taking insulin to not taking insulin if you are male, the odds of having hypertension increases by roughly 37%.

+ When you move from having chronic kidney disease to not having chronic kidney disease if you are male, the odds of having hypertension decreases by roughly 77%.

+ For a one unit increase in BMI if you are male, you would expect your odds of having hypertension to increase by roughly 11%. 

+ When you move from being physically active to not being physically active if you are male, the odds of having hypertension increases by roughly 7%.

+ When you move from drinking at least 12 alcoholic drinks in a year to not if you are male, the odds of having hypertension decreases by roughly 13%.

+ When you move from never using salt to rarely if you are male, the odds of having hypertension decreases by roughly 30%.

+ When you move from never using salt to occasionally if you are male, the odds of having hypertension decreases by roughly 20%.

+ When you move from never using rarely to very often if you are male, the odds of having hypertension decreases by roughly 32%.

+ For a one unit increase in potassium if you are male, you would expect no change in your odds.

+ For a one unit increase in age if you are female, you would expect no change in your odds.

+ When you move from American Mexican race to Other Hispanic if you are female, the odds of having hypertension decreases by roughly 10%.

+ When you move from American Mexican race to Non-Hispanic White if you are female, the odds of having hypertension decreases by roughly 35%.

+ When you move from American Mexican race to Non-Hispanic Black if you are female, the odds of having hypertension decreases by roughly 27%.

+ When you move from American Mexican race to Other Race including multi-race, the odds of having hypertension decreases by roughly 23%.

+ When you move from smoking to not smoking if you are female, the odds of having hypertension decreases by roughly 29%.

+ When you move from having diabetes to not having diabetes if you are female, the odds of having hypertension decreases by roughly 38%.

+ When you move from having diabetes to borderline having diabetes if you are female, the odds of having hypertension decreases by roughly 38%.

+ When you move from taking insulin to not taking insulin if you are female, the odds of having hypertension decreases by roughly 18%.

+ When you move from having chronic kidney disease to not having chronic kidney disease if you are female, the odds of having hypertension decreases by roughly 15%.

+ For a one unit increase in BMI if you are female, you would expect your odds of having hypertension to decrease by roughly 4%. 

+ When you move from being physically active to not being physically active if you are female, the odds of having hypertension increases by roughly 4%.

+ When you move from drinking at least 12 alcoholic drinks in a year to not if you are female, the odds of having hypertension increases by roughly 37%.

+ When you move from never using salt to rarely if you are female, the odds of having hypertension increases by roughly 20%.

+ When you move from never using salt to occasionally if you are female, the odds of having hypertension increases by roughly 19%.

+ When you move from never using rarely to very often if you are female, the odds of having hypertension decreases by roughly 11%.

+ For a one unit increase in potassium if you are female, you would expect your odds to have no change.
