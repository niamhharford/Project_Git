---
title: "Dissertation 2009/2010 Data"
author: "Niamh Harford 20251644"
date: "4/9/2021"
output: html_document
---

```{r}
#Packages I need
suppressMessages(library(nhanesA))
suppressMessages(library(tidyverse))
suppressMessages(library(ggplot2))
```


```{r, results='hide'}
#209/2010 data
smq_f <- nhanes('SMQ_F') 
demo_f <- nhanes('DEMO_F')
diq_f <- nhanes('DIQ_F') 
kiq_u_f <- nhanes('KIQ_U_F')
bmx_f <- nhanes('BMX_F') 
bpq_f<- nhanes('BPQ_F')
paq_f <- nhanes('PAQ_F')
alq_f <- nhanes('ALQ_F')
dr1tot_f <- nhanes('DR1TOT_F') #salt and potassium
```

```{r , results='hide'}
#Translate
demo_f <- nhanesTranslate('DEMO_F', c('RIAGENDR', 'RIDRETH1', 'RIDAGEYR'), data=demo_f)
bmx_f <- nhanesTranslate('BMX_F', 'BMXBMI', data=bmx_f)
smq_f <- nhanesTranslate('SMQ_F', 'SMQ020', data=smq_f)
diq_f <- nhanesTranslate('DIQ_F', c('DIQ010', 'DIQ050'), data=diq_f)
kiq_u_f <- nhanesTranslate('KIQ_U_F', c('KIQ022'), data=kiq_u_f)
bpq_f <- nhanesTranslate('BPQ_F', 'BPQ020', data=bpq_f)
paq_f <- nhanesTranslate('PAQ_F', 'PAQ665', data = paq_f)
alq_f <- nhanesTranslate('ALQ_F', 'ALQ101', data = alq_f)
dr1tot_f <- nhanesTranslate('DR1TOT_F', c('DBD100','DR1TPOTA'), data = dr1tot_f)
```

```{r}
#merging the data
comb1 <- merge(demo_f, smq_f)
comb2 <- merge(comb1, diq_f)
comb3 <- merge(comb2, kiq_u_f)
comb4 <- merge(comb3, bmx_f)
comb5 <- merge(comb4, bpq_f)
comb6 <- merge(comb5, paq_f)
comb7 <- merge(comb6, alq_f)
comb8 <- merge(comb7, dr1tot_f)
select_cols <- c('BPQ020','RIAGENDR', 'RIDAGEYR', 'RIDRETH1', 'SMQ020', 'DIQ010', 'DIQ050', 'KIQ022', 'BMXBMI', 'PAQ665', 'ALQ101', 'DBD100', 'DR1TPOTA')
comb_data <- comb8 %>% dplyr::select(all_of(select_cols))
```

```{r}
#Another way to join data
select_cols <- c('BPQ020','RIAGENDR', 'RIDAGEYR', 'RIDRETH1', 'SMQ020', 'DIQ010', 'DIQ050', 'KIQ022', 'BMXBMI', 'PAQ665','ALQ101', 'DBD100', 'DR1TPOTA')
data <- Reduce(merge, list(demo_f, smq_f, diq_f, kiq_u_f, bmx_f, bpq_f, paq_f, alq_f,dr1tot_f))
data <- data %>% dplyr::select(all_of(select_cols))
head(data)
```

```{r}
#Adjust the structure of the data
glimpse(data)
data$RIDAGEYR <- as.numeric(data$RIDAGEYR)
data$BMXBMI <- as.numeric(data$BMXBMI)
data$PAQ665 <- as.numeric(data$PAQ665)
data$ALQ101 <- as.numeric(data$ALQ101)
data$DR1TPOTA <- as.numeric(data$DR1TPOTA)
glimpse(data)
```

```{r, eval=FALSE}
save(data, file = "data_09_10.RData")
load("data_09_10.RData")
```

```{r}
#checking the responses for each factor variables
levels(data$BPQ020) #need to remove dont knows
levels(data$RIDRETH1) #dont need to fix anything
levels(data$SMQ020) #dont need to remove dont knows
levels(data$DIQ010) #need to remove dont knows
levels(data$DIQ050) #dont need to remove dont knows
levels(data$KIQ022) #need to remove dont knows
levels(data$DBD100) #need to remove dont knows
```

```{r}
#removing the unknown "dont know" answers from the data

data1 <- data %>% filter(BPQ020 != "Don't know") %>% filter(DIQ010 != "Don't know") %>% filter(KIQ022 != "Don't know") %>% filter(DBD100 != "Don't know")

#readjusting the levels for each factor variable
data1 <- data1 %>% droplevels()


# save(data1, file = "data1_09_10.RData")
# load("data1_09_10.RData")
```


```{r}
glimpse(data1)
```


```{r}
#Count how much Na values in each variable

data1 %>%
  summarise(count_hyp = sum(is.na(BPQ020)),
            count_gender = sum(is.na(RIAGENDR)),
            count_age = sum(is.na(RIDAGEYR)),
            count_race = sum(is.na(RIDRETH1)),
            count_smoke20 = sum(is.na(SMQ020)),
            count_diabetes10 = sum(is.na(DIQ010)),
            count_diabetes50 = sum(is.na(DIQ050)),
            count_kidney = sum(is.na(KIQ022)),
            count_age = sum(is.na(RIDAGEYR)),
            count_bmi = sum(is.na(BMXBMI)),
            count_activity = sum(is.na(PAQ665)),
            count_alcohol = sum(is.na(ALQ101)),
            count_salt = sum(is.na(DBD100)),
            count_potassium = sum(is.na(DR1TPOTA)))

#313 missing in alcohol variable


#Count how much Na values in each variable

data %>%
  summarise(count_hyp = sum(is.na(BPQ020)),
            count_gender = sum(is.na(RIAGENDR)),
            count_age = sum(is.na(RIDAGEYR)),
            count_race = sum(is.na(RIDRETH1)),
            count_smoke20 = sum(is.na(SMQ020)),
            count_diabetes10 = sum(is.na(DIQ010)),
            count_diabetes50 = sum(is.na(DIQ050)),
            count_kidney = sum(is.na(KIQ022)),
            count_age = sum(is.na(RIDAGEYR)),
            count_bmi = sum(is.na(BMXBMI)),
            count_activity = sum(is.na(PAQ665)),
            count_alcohol = sum(is.na(ALQ101)),
            count_salt = sum(is.na(DBD100)),
            count_potassium = sum(is.na(DR1TPOTA)))

#a lot of the missing data for salt variable seemed to be in the dont know
```

```{r}
#Visualise the number of missing values

library(naniar)
gg_miss_var(data) + theme_bw() #All data
gg_miss_var(data1) + theme_bw() #Data with dont know responses removed

#DBD100 now has 0 missing values after removing dont know responses
```

```{r}
nrow(data1)
#3931
data2 <- na.omit(data1)
nrow(data2)
#3592
```



```{r}
#I am going to try this code for the data dataset (no levels have been altered)
nrow(data)
#6059
data_a <- na.omit(data)
nrow(data_a)
#3614
```

There seems to be no major difference between the two datasets (data1, with levels altered and data) when I omit the NA values

```{r}
#Rename the variables to meaningful names
data3 <- data2 %>% rename(Hypertension = BPQ020,
                        Gender = RIAGENDR,
                        Age = RIDAGEYR,
                        Race = RIDRETH1,
                        Smoking = SMQ020,
                        Diabetes = DIQ010,
                        Insulin = DIQ050,
                        KidneyF = KIQ022,
                        BMI = BMXBMI,
                        PhysActivity = PAQ665,
                        Alcohol = ALQ101,
                        Salt = DBD100,
                        Potassium = DR1TPOTA
                        )
```



```{r}
# save(data3, file = "data3_09_10.RData")
# load("data3_09_10.RData")
glimpse(data3)
```

```{r}
#Logistic regression

log_reg <- glm(Hypertension ~ ., data = data3, family = binomial())
summary(log_reg)

```

```{r}
coefficients(log_reg) %>% exp() %>% round(digits = 5)
```

#### **Interpretation:**
+ The odds of having hypertension if you're a female is expected to increase by roughly 3%. 

+ For a one unit increase in age you would expect your odds of having hypertension to decrease by roughly 6%. 

+ When you move from American Mexican race to Other Hispanic, the odds of having hypertension decreases by roughly 27%.

+ When you move from American Mexican race to Non-Hispanic White, the odds of having hypertension decreases by roughly 27%.

+ When you move from American Mexican race to Non-Hispanic Black, the odds of having hypertension decreases by roughly 57%.

+ When you move from American Mexican race to Other Race including multi-race, the odds of having hypertension decreases by roughly 36%.

+ When you move from smoking to not smoking, the odds of having hypertension increases by roughly 26%.

+ When you move from having diabetes to not having diabetes, the odds of having hypertension is roughly **3.6 times higher.**

+ When you move from having diabetes to borderline having diabetes, the odds of having hypertension increases by roughly 28%.

+ When you move from taking insulin to not taking insulin, the odds of having hypertension decreases by roughly 28%.

+ When you move from having chronic kidney disease to not having chronic kidney disease, the odds of having hypertension  is roughly **8.89 times higher.**

+ For a one unit increase in BMI you would expect your odds of having hypertension to decrease by roughly 8%. 

+ For a one unit increase in physical activity you would expect your odds of having hypertension to decrease by roughly 19%. 

+ For a one unit increase in alcohol you would expect your odds of having hypertension to decrease roughly by 8%.

+ When you move from using salt rarely to occasionally, the odds of having hypertension increases by roughly 23%.

+ When you move from using salt rarely to very often, the odds of having hypertension increases by roughly 21%.

+ For a one unit increase in potassium you would expect your odds of having hypertension to be equally likely.


**Variables that have a negative effect on Hypertension **

+ Age     
+ RaceOther Hispanic 
+ RaceNon-Hispanic White
+ RaceNon-Hispanic Black 
+ RaceOther Race - Including Multi-Race
+ BMI
+ Alcohol
+ Physical Activity



When comparing what variables have a negative effect on Hypertension between the two years:

Salt levels seem to vary, in the 2015/2016 data salt seems to have a negative effect on hypertension, but it does not seem to have a negative effect on hypertension for the data 2009/2010. GenderFemale appeared to have a negative effect on hypertension in the 2015/2016 data, while it does not in 2009/2010 data. Finally, three numeric variables, BMI, Alcohol and Physical Activity had a negative effect on hypertension for the 2009/2010 data, whereas it did not for the 2015/2016. 